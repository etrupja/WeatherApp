@page "/"
@using WeatherApp.Dtos
@rendermode InteractiveServer
@inject IJSRuntime JSRuntime

<PageTitle>Home</PageTitle>


<div class="container">
    <div class="row">
        <div class="col-md-6 offset-3">
            <div class="input-group">
                <input type="text" 
                    placeholder="Search for a city..." 
                    class="form-control" 
                    id="weatherCity"
                    @bind="weatherCity"
                >
                <button 
                    class="btn btn-outline-secondary" 
                    @onclick="() => CheckWeatherAsync(weatherCity)"
                >Check weather</button>
                <button class="btn btn-outline-secondary">Favorite</button>
            </div>

            <hr />

            <div class="card text-center">
                <div class="card-header" id="weather_city">
                    -
                </div>
                <div class="card-body">
                    <h5 class="card-title" id="weather_icon"></h5>
                    <p class="card-text" id="weather_forecast"></p>
                    <p class="card-text" id="weather_temperature"></p>

                </div>
            </div>
        </div>
    </div>
</div>


@code {
    private string weatherCity = "";
    private WeatherResponse weatherResponse = new WeatherResponse();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // await JSRuntime.InvokeVoidAsync("alert", "Welcome to this course!");
            // await JSRuntime.InvokeVoidAsync("localStorage.setItem", "welcomeTxt", "Welcome to this course!");

            await JSRuntime.InvokeVoidAsync("import", "/scripts/custom.js");
        }
    }

    protected async Task CheckWeatherAsync(string cityName)
    {
        weatherResponse = await JSRuntime.InvokeAsync<WeatherResponse>("checkWeather", cityName);
    }
}
